<?php

/**
 * @file soyoco.module
 * Drupal 7 module
 */

/**
 * implements hook_nodeapi()
 *
 *
 */
function soyoco_init() {
  module_load_include('inc','soyoco','soyoco.util');
  module_load_include('inc','soyoco','soyoco.compute');
  module_load_include('inc','soyoco','soyoco.node');
  module_load_include('inc','soyoco','soyoco.query');
  if (arg(0) === 'shares') {
    _soyoco_update_shares();
    $final_date = _soyoco_query_final_work_shift_date();
    drupal_set_message('The final work shift date is ' . date('D, n/d',$final_date));
  }
}


/**
 * implements hook_theme()
 *
 *
 */
function soyoco_theme() {
  $tpl_path = drupal_get_path('module', 'soyoco') . '/theme';
  return array(
    'soyoco_yogurt_share' => array(
      'variables' => array('node' => NULL),
      'template' => 'yogurt-share',
      'path' => $tpl_path,
    ),
  );
}

/**
 * implements hook_user_view()
 *
 *
 */
function soyoco_user_view($account, $view_mode = 'full', $langcode = NULL) {
  //drupal_set_message(t('Look at me! 2'));
    
  // removing 'member for...' message
  if (!isset($account->content['summary'])) {
    $account->content['summary'] = array();
  }
  if (isset($account->content['summary']['member_for'])) {
    unset($account->content['summary']['member_for']);
  }
  
  // adding more to the user summary  
  $account->content['summary'] += array(
    '#type' => 'user_profile_category', 
    '#attributes' => array('class' => array('user-member')), 
    '#weight' => 5, 
    '#title' => t('My Yogurt Account'),
  );
  
  $account->content['summary']['soyoco'] =  array(
    '#type' => 'user_profile_item',
    '#attributes' => array('class' => array('soyoco')), 
    '#title' =>  t('My Active Share'),
    '#markup' => 
      _soyoco_render_my_active_share(), 
      '#attributes' => array('class' => array('icon-heart')
    ),
  );
}
